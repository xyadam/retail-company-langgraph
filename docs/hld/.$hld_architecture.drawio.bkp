<mxfile host="65bd71144e">
    <diagram name="HLD Architecture" id="hld1">
        <mxGraphModel dx="619" dy="849" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="OpsFleet Data Analysis Agent — High-Level Design (HLD)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontStyle=1;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="400" y="20" width="540" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="client" value="Client&#xa;(CLI / Web Frontend)&#xa;&#xa;Sends: user_id + question&#xa;Receives: executive report" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;verticalAlign=middle;align=center;spacingTop=4;" parent="1" vertex="1">
                    <mxGeometry x="540" y="80" width="220" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="agent_container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#333333;strokeWidth=2;dashed=0;" parent="1" vertex="1">
                    <mxGeometry x="340" y="240" width="620" height="340" as="geometry"/>
                </mxCell>
                <mxCell id="agent_title" value="LangGraph Agent (Python)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="500" y="248" width="200" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="node_router" value="Router&#xa;(Intent Classification)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="360" y="290" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_golden" value="Golden Knowledge&#xa;Retrieval" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="520" y="290" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_sql_gen" value="SQL Generator&#xa;+ Validator (QA)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="680" y="290" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_executor" value="SQL Executor&#xa;+ PII Filter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="840" y="290" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_prefs" value="User Preferences&#xa;Loader" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="360" y="370" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_report" value="Report Writer&#xa;(Persona-aware)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="520" y="370" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_report_mgr" value="Report Manager&#xa;(CRUD + Delete Confirmation)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="680" y="370" width="160" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_logger" value="Interaction Logger" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="360" y="450" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_pref_updater" value="User Preference&#xa;Updater&#xa;(batch of 10)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="520" y="450" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="node_general" value="General&#xa;Response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" parent="1" vertex="1">
                    <mxGeometry x="680" y="450" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="gemini" value="Gemini 2.5 Flash&#xa;(LLM API)&#xa;&#xa;Routing, SQL Generation,&#xa;SQL Validation, Report Writing,&#xa;Preference Evaluation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;verticalAlign=middle;align=center;spacingTop=4;" parent="1" vertex="1">
                    <mxGeometry x="40" y="320" width="220" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="bigquery" value="Google BigQuery&#xa;(Read-Only)&#xa;&#xa;thelook_ecommerce&#xa;orders, order_items,&#xa;products, users" style="shape=cylinder3;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;verticalAlign=middle;align=center;size=12;boundedLbl=1;" parent="1" vertex="1">
                    <mxGeometry x="1060" y="260" width="180" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="appdb_container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#333333;strokeWidth=2;dashed=0;" parent="1" vertex="1">
                    <mxGeometry x="220" y="660" width="860" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="appdb_title" value="Application Database (PostgreSQL)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="440" y="668" width="280" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="tbl_golden" value="golden_knowledge&#xa;&#xa;question (TEXT)&#xa;sql (TEXT)&#xa;report (TEXT)&#xa;embedding (VECTOR)" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#d5e8d4;strokeColor=#82b366;whiteSpace=wrap;html=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="240" y="710" width="180" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="tbl_prefs" value="user_preferences&#xa;&#xa;user_id (TEXT, PK)&#xa;preference_profile (JSONB)&#xa;updated_at (TIMESTAMP)" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#dae8fc;strokeColor=#6c8ebf;whiteSpace=wrap;html=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="440" y="710" width="200" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="tbl_logs" value="interaction_logs&#xa;&#xa;user_id, timestamp&#xa;question, generated_sql&#xa;result, report, latency&#xa;error_count, retry_count&#xa;pii_blocks, intent&#xa;processed_for_prefs (BOOL)" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#fff2cc;strokeColor=#d6b656;whiteSpace=wrap;html=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="240" y="845" width="200" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="tbl_reports" value="saved_reports&#xa;&#xa;user_id (TEXT, FK)&#xa;title (TEXT)&#xa;report_content (TEXT)&#xa;created_at (TIMESTAMP)" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#f8cecc;strokeColor=#b85450;whiteSpace=wrap;html=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="660" y="710" width="190" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="tbl_persona" value="persona_config&#xa;&#xa;tone (TEXT)&#xa;report_style (TEXT)&#xa;greeting (TEXT)&#xa;updated_by (TEXT)" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#e1d5e7;strokeColor=#9673a6;whiteSpace=wrap;html=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="870" y="710" width="180" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="arr_client_agent" value="user_id + question" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#6c8ebf;fontSize=11;fontStyle=0;labelBackgroundColor=#ffffff;" parent="1" source="client" target="agent_container" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="650" y="200" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arr_agent_gemini" value="LLM calls&#xa;(routing, SQL gen,&#xa;validation, reports,&#xa;pref evaluation)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#9673a6;fontSize=10;fontStyle=0;labelBackgroundColor=#ffffff;" parent="1" source="agent_container" target="gemini" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arr_agent_bq" value="SQL queries&#xa;(read-only)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#82b366;fontSize=11;fontStyle=0;labelBackgroundColor=#ffffff;" parent="1" source="agent_container" target="bigquery" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arr_agent_db" value="Read/Write&#xa;(golden knowledge, preferences,&#xa;logs, reports, persona)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#d6b656;fontSize=10;fontStyle=0;labelBackgroundColor=#ffffff;" parent="1" source="agent_container" target="appdb_container" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arr_learning" value="System integrators curate&#xa;successful interactions into&#xa;golden knowledge" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#82b366;dashed=1;dashPattern=8 4;fontSize=10;fontStyle=2;labelBackgroundColor=#ffffff;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="tbl_logs" target="tbl_golden" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="470" y="920"/>
                            <mxPoint x="470" y="840"/>
                            <mxPoint x="230" y="840"/>
                            <mxPoint x="230" y="770"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arr_pref_update" value="Batch update every&#xa;10 unprocessed interactions" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#6c8ebf;dashed=1;dashPattern=8 4;fontSize=10;fontStyle=2;labelBackgroundColor=#ffffff;" parent="1" source="tbl_logs" target="tbl_prefs" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="540" y="920"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="admin_user" value="Admin / CEO&#xa;(Non-developer)" style="shape=mxgraph.basic.person;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="1120" y="700" width="80" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="arr_admin_persona" value="Edit tone/style&#xa;(no code deploy)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#9673a6;fontSize=10;fontStyle=2;labelBackgroundColor=#ffffff;" parent="1" source="admin_user" target="tbl_persona" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="manager_user" value="Store / Regional&#xa;Managers" style="shape=mxgraph.basic.person;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="610" width="80" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="arr_manager_client" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#6c8ebf;fontSize=10;" parent="1" source="manager_user" target="client" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="legend_container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" parent="1" vertex="1">
                    <mxGeometry x="1100" y="440" width="280" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="legend_title" value="Requirements Mapping" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=12;fontStyle=1;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="1110" y="448" width="160" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="legend_items" value="1. Hybrid Intelligence → Golden Knowledge&#xa;2. PII Masking → SQL Executor + PII Filter&#xa;3. High-Stakes Oversight → Report Manager&#xa;4. Continuous Improvement →&#xa;    User: Preference Updater (batch/10)&#xa;    System: Interaction Logs → Curation&#xa;5. Resilience → SQL retry loop (max 3)&#xa;6. Quality Assurance → SQL Validator&#xa;7. Logging → Interaction Logger&#xa;8. Persona → persona_config table" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=0;fontColor=#555555;spacingLeft=4;" parent="1" vertex="1">
                    <mxGeometry x="1110" y="474" width="260" height="170" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>