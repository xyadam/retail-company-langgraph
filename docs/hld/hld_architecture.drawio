<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.2.9 Chrome/140.0.7339.249 Electron/38.7.2 Safari/537.36" version="29.2.9">
  <diagram name="HLD Architecture" id="hld1">
    <mxGraphModel dx="1540" dy="1028" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="client" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;verticalAlign=middle;align=center;spacingTop=4;" value="Client&#xa;(CLI / Web Frontend)&#xa;&#xa;Sends: user_id + question&#xa;Receives: executive report" vertex="1">
          <mxGeometry height="100" width="220" x="540" y="80" as="geometry" />
        </mxCell>
        <mxCell id="agent_container" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#333333;strokeWidth=2;dashed=0;" value="" vertex="1">
          <mxGeometry height="340" width="620" x="340" y="240" as="geometry" />
        </mxCell>
        <mxCell id="agent_title" parent="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;fontStyle=1;fontColor=#333333;" value="LangGraph Agent (Python)" vertex="1">
          <mxGeometry height="30" width="200" x="500" y="248" as="geometry" />
        </mxCell>
        <mxCell id="node_router" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="Router&#xa;(Intent Classification)" vertex="1">
          <mxGeometry height="50" width="140" x="360" y="290" as="geometry" />
        </mxCell>
        <mxCell id="node_golden" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="Golden Knowledge&#xa;Retrieval" vertex="1">
          <mxGeometry height="50" width="140" x="520" y="290" as="geometry" />
        </mxCell>
        <mxCell id="node_sql_gen" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="SQL Generator&#xa;+ Validator (QA)" vertex="1">
          <mxGeometry height="50" width="140" x="680" y="290" as="geometry" />
        </mxCell>
        <mxCell id="node_executor" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="SQL Executor&#xa;+ PII Filter" vertex="1">
          <mxGeometry height="50" width="100" x="840" y="290" as="geometry" />
        </mxCell>
        <mxCell id="node_prefs" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="User Preferences&#xa;Loader" vertex="1">
          <mxGeometry height="50" width="140" x="360" y="370" as="geometry" />
        </mxCell>
        <mxCell id="node_report" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="Report Writer&#xa;(Persona-aware)" vertex="1">
          <mxGeometry height="50" width="140" x="520" y="370" as="geometry" />
        </mxCell>
        <mxCell id="node_report_mgr" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="Report Manager&#xa;(CRUD + Delete Confirmation)" vertex="1">
          <mxGeometry height="50" width="140" x="680" y="370" as="geometry" />
        </mxCell>
        <mxCell id="node_logger" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="Interaction Logger" vertex="1">
          <mxGeometry height="50" width="140" x="360" y="450" as="geometry" />
        </mxCell>
        <mxCell id="node_pref_updater" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="User Preference&#xa;Updater&#xa;(batch of 10)" vertex="1">
          <mxGeometry height="50" width="140" x="520" y="450" as="geometry" />
        </mxCell>
        <mxCell id="node_general" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=0;align=center;" value="General&#xa;Response" vertex="1">
          <mxGeometry height="50" width="120" x="680" y="450" as="geometry" />
        </mxCell>
        <mxCell id="gemini" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;verticalAlign=middle;align=center;spacingTop=4;" value="Gemini 2.5 Flash&#xa;(LLM API)&#xa;&#xa;Routing, SQL Generation,&#xa;SQL Validation, Report Writing,&#xa;Preference Evaluation" vertex="1">
          <mxGeometry height="130" width="220" x="40" y="345" as="geometry" />
        </mxCell>
        <mxCell id="bigquery" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;verticalAlign=middle;align=center;size=12;boundedLbl=1;" value="Google BigQuery&lt;br&gt;(Read-Only)&lt;div&gt;&lt;br/&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="120" width="180" x="1100" y="350" as="geometry" />
        </mxCell>
        <mxCell id="appdb_container" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#333333;strokeWidth=2;dashed=0;" value="" vertex="1">
          <mxGeometry height="310" width="860" x="220" y="660" as="geometry" />
        </mxCell>
        <mxCell id="appdb_title" parent="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;fontStyle=1;fontColor=#333333;" value="Application Database (PostgreSQL)" vertex="1">
          <mxGeometry height="30" width="280" x="440" y="668" as="geometry" />
        </mxCell>
        <mxCell id="tbl_golden" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#d5e8d4;strokeColor=#82b366;whiteSpace=wrap;html=1;fontSize=11;" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;golden_knowledge&lt;/span&gt;&lt;/div&gt;&lt;br&gt;question&lt;br&gt;sql&lt;br&gt;report" vertex="1">
          <mxGeometry height="100" width="180" x="240" y="710" as="geometry" />
        </mxCell>
        <mxCell id="tbl_prefs" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#dae8fc;strokeColor=#6c8ebf;whiteSpace=wrap;html=1;fontSize=11;" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;user_preferences&lt;br&gt;&lt;br&gt;user_id&lt;br&gt;personal_preferences&lt;br&gt;updated_at" vertex="1">
          <mxGeometry height="100" width="200" x="440" y="710" as="geometry" />
        </mxCell>
        <mxCell id="tbl_logs" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#fff2cc;strokeColor=#d6b656;whiteSpace=wrap;html=1;fontSize=11;" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;interaction_logs&lt;/span&gt;&lt;/div&gt;&lt;br&gt;user_id, timestamp&lt;br&gt;question, generated_sql&lt;br&gt;result, report,&lt;br&gt;error_count, retry_count&lt;br&gt;pii_blocks, intent" vertex="1">
          <mxGeometry height="115" width="200" x="240" y="845" as="geometry" />
        </mxCell>
        <mxCell id="tbl_reports" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#f8cecc;strokeColor=#b85450;whiteSpace=wrap;html=1;fontSize=11;" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;saved_reports&lt;br&gt;&lt;br&gt;user_id&lt;br&gt;title&lt;br&gt;report_content&lt;br&gt;created_at" vertex="1">
          <mxGeometry height="100" width="190" x="660" y="710" as="geometry" />
        </mxCell>
        <mxCell id="tbl_persona" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=0;fillColor=#e1d5e7;strokeColor=#9673a6;whiteSpace=wrap;html=1;fontSize=11;" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;application_persona_config&lt;/span&gt;&lt;/div&gt;&lt;br&gt;tone&lt;br&gt;report_style&lt;br&gt;updated_by" vertex="1">
          <mxGeometry height="100" width="180" x="870" y="710" as="geometry" />
        </mxCell>
        <mxCell id="arr_client_agent" edge="1" parent="1" source="client" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#6c8ebf;fontSize=11;fontStyle=0;labelBackgroundColor=#ffffff;" target="agent_container" value="user_id + question">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="650" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr_agent_gemini" edge="1" parent="1" source="agent_container" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#9673a6;fontSize=10;fontStyle=0;labelBackgroundColor=#ffffff;" target="gemini" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;">
          <mxGeometry relative="1" y="40" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr_agent_bq" edge="1" parent="1" source="agent_container" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#82b366;fontSize=11;fontStyle=0;labelBackgroundColor=#ffffff;" target="bigquery" value="SQL queries&#xa;(read-only)">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr_agent_db" edge="1" parent="1" source="agent_container" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;strokeWidth=2;strokeColor=#d6b656;fontSize=10;fontStyle=0;labelBackgroundColor=#ffffff;" target="appdb_container" value="Read/Write&#xa;(golden knowledge, preferences,&#xa;logs, reports, persona)">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arr_pref_update" edge="1" parent="1" source="tbl_logs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=classic;endFill=1;strokeWidth=1;strokeColor=#6c8ebf;dashed=1;dashPattern=8 4;fontSize=10;fontStyle=2;labelBackgroundColor=#ffffff;" target="tbl_prefs" value="Batch update every&#xa;10 unprocessed interactions">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="540" y="920" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LL7Gt9UFqr6Zglu7XBF_-1" edge="1" parent="1" source="admin_user" style="edgeStyle=none;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;startSize=8;endSize=8;" target="appdb_container" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="admin_user" parent="1" style="shape=mxgraph.basic.person;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1;align=center;" value="Admin / CEO&#xa;(Non-developer)" vertex="1">
          <mxGeometry height="80" width="80" x="1210" y="772.5" as="geometry" />
        </mxCell>
        <mxCell id="legend_container" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" value="" vertex="1">
          <mxGeometry height="180" width="250" x="40" y="36" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" parent="1" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=12;fontStyle=1;fontColor=#333333;" value="Requirements Mapping" vertex="1">
          <mxGeometry height="26" width="160" x="50" y="44" as="geometry" />
        </mxCell>
        <mxCell id="legend_items" parent="1" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=0;fontColor=#555555;spacingLeft=4;" value="1. Hybrid Intelligence → Golden Knowledge&lt;br&gt;2. PII Masking → SQL Executor + PII Filter&lt;br&gt;3. High-Stakes Oversight → Report Manager&lt;br&gt;4. Continuous Improvement →&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;User: Preference Updater (batch/10)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;System: Golden Bucket → Curation&lt;br&gt;5. Resilience → SQL retry loop (max 3)&lt;br&gt;6. Quality Assurance → SQL Validator&lt;br&gt;7. Logging → Interaction Logger&lt;br&gt;8. Persona → persona_config table" vertex="1">
          <mxGeometry height="130" width="220" x="50" y="70" as="geometry" />
        </mxCell>
        <mxCell id="LL7Gt9UFqr6Zglu7XBF_-2" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;" value="&lt;span style=&quot;font-size: 10px; font-style: italic; text-wrap-mode: nowrap; background-color: rgb(255, 255, 255);&quot;&gt;Edit tone/style&lt;/span&gt;&lt;br style=&quot;font-size: 10px; font-style: italic; text-wrap-mode: nowrap;&quot;&gt;&lt;span style=&quot;font-size: 10px; font-style: italic; text-wrap-mode: nowrap; background-color: rgb(255, 255, 255);&quot;&gt;(no code deploy)&lt;/span&gt;" vertex="1">
          <mxGeometry height="50" width="60" x="1120" y="807.5" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
